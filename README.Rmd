---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# rsdot  <a href='https://github.com/PaulESantos/ppendemic'><img src='man/figures/rsdot_logo.png' align="right" height="280" width="260" /></a>

<!-- badges: start -->
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://lifecycle.r-lib.org/articles/stages.html#experimental)
[![CRAN status](https://www.r-pkg.org/badges/version/rsdot)](https://CRAN.R-project.org/package=rsdot)
[![R-CMD-check](https://github.com/PaulESantos/rsdot/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/PaulESantos/rsdot/actions/workflows/R-CMD-check.yaml)
[![Codecov test coverage](https://codecov.io/gh/PaulESantos/rsdot/graph/badge.svg)](https://app.codecov.io/gh/PaulESantos/rsdot)
<!-- badges: end -->


`rsdot` proporciona acceso program√°tico a la informaci√≥n geogr√°fica producida y recopilada por la Secretar√≠a de Demarcaci√≥n y Organizaci√≥n Territorial (SDOT) de la Presidencia del Consejo de Ministros (PCM) del Per√∫.

El paquete facilita el acceso y manipulaci√≥n de diversas capas vectoriales, incluyendo:

- **L√≠mites censales INEI 2023**: Departamentos, provincias y distritos
- **Tiempos de desplazamiento**: Accesibilidad territorial a capitales departamentales
- **Densidad y crecimiento poblacional**: Interpolaci√≥n espacial de censos 2007-2017
- **Informaci√≥n del modelo geogr√°fico SDOT**: Infraestructura, centros poblados, riesgos y peligros
- **Otras capas tem√°ticas territoriales**

### ‚ö†Ô∏è Importante

Los l√≠mites censales del INEI provistos por este paquete son **referenciales** y no constituyen l√≠mites oficiales ni tienen efecto legal demarcatorio.

## ‚ú® Caracter√≠sticas

- ‚úÖ **Acceso program√°tico** a datos espaciales oficiales del Per√∫
- ‚úÖ **Descarga autom√°tica** desde OSF con cach√© inteligente
- ‚úÖ **Compatible** con `sf`, `ggplot2`, `dplyr` y herramientas SIG modernas
- ‚úÖ **Validaci√≥n de geometr√≠as** autom√°tica para operaciones espaciales

### üì¶ Funciones principales

- `get_departamentos()` - L√≠mites censales departamentales
- `get_provincias()` - L√≠mites censales provinciales
- `get_distritos()` - L√≠mites censales distritales
- `get_tiempos_desplazamiento()` - Tiempos de desplazamiento a capitales
- `get_densidad_poblacional()` - Densidad y crecimiento poblacional intercensal

## üì¶ Instalaci√≥n
Instalar la versi√≥n de desarrollo desde GitHub:
```r
# Usando remotes
install.packages("remotes")
remotes::install_github("PaulESantos/rsdot")

# O usando pak (recomendado)
install.packages("pak")
pak::pak("PaulESantos/rsdot")
```

## üöÄ Ejemplos de uso

### Cargar el paquete
```{r }
library(rsdot)
library(sf)
library(ggplot2)
library(dplyr)
```

### 1. L√≠mites censales

#### Obtener departamentos
```{r}
deps <- get_departamentos()
deps

# Visualizaci√≥n b√°sica
ggplot(deps) +
  geom_sf(fill = "steelblue", color = "white") +
  theme_minimal() +
  labs(
    title = "Departamentos del Per√∫",
    caption = "Fuente: SDOT - PCM / INEI 2023"
  )
```

#### Obtener provincias de un departamento
```{r}
cusco_prov <- get_provincias(departamento = "CUSCO")
head(cusco_prov)

# Mapa de provincias
ggplot(cusco_prov) +
  geom_sf(aes(fill = nombprov), color = "white", linewidth = 0.3) +
  scale_fill_viridis_d(option = "plasma") +
  theme_minimal() +
  labs(
    title = "Provincias del Departamento de Cusco",
    subtitle = "INEI 2023 | Referencial",
    fill = "Provincia"
  )
```

#### Obtener distritos

Ejemplo: Ca√±ete (Lima)
```{r}
canete <- get_distritos(
  provincia = "CA√ëETE",
  departamento = "LIMA"
)

# Visualizaci√≥n
ggplot(canete) +
  geom_sf(aes(fill = nombdist), color = "white", linewidth = 0.3) +
  scale_fill_viridis_d() +
  theme_minimal() +
  labs(
    title = "Distritos de la Provincia de Ca√±ete",
    subtitle = "Referencia Censal INEI 2023",
    fill = "Distrito"
  )
```

### 2. Tiempos de desplazamiento
```r
# Cargar l√≠mites de Cusco
cusco <- get_departamentos(departamento = "CUSCO")

# Obtener tiempos de desplazamiento
tiempos_cusco <- get_tiempos_desplazamiento(area_interes = cusco)

# Visualizar accesibilidad territorial
ggplot() +
  geom_sf(data = tiempos_cusco, aes(fill = cat_tiempo), color = NA) +
  geom_sf(data = cusco, fill = NA, color = "black", linewidth = 1) +
  scale_fill_brewer(palette = "YlOrRd", name = "Tiempo", direction = -1) +
  labs(
    title = "Tiempo de Desplazamiento a Capital m√°s Cercana",
    subtitle = "Departamento de Cusco",
    caption = "Fuente: INEI - MTC | Visor - SDOT"
  ) +
  theme_void()
```

### 3. Densidad y crecimiento poblacional

#### Ver departamentos disponibles
```{r}
# Listar departamentos con datos disponibles
get_densidad_poblacional()
```

#### Cargar datos de un departamento
```{r}
densidad_cusco <- get_densidad_poblacional(departamento = "CUSCO")
densidad_cusco

# Mapa de nivel de crecimiento
ggplot(densidad_cusco) +
  geom_sf(aes(fill = nivel), color = NA) +
  scale_fill_brewer(
    palette = "RdYlGn",
    name = "Nivel de\nCrecimiento"
  ) +
  labs(
    title = "Crecimiento Poblacional por Nivel",
    subtitle = "Departamento de Cusco (2007-2017)",
    caption = "Fuente: INEI | Visor - SDOT"
  ) +
  theme_minimal()
```

#### Filtrado por provincia y distrito
```{r}
# Cargar solo una provincia
densidad_prov_cusco <- get_densidad_poblacional(
  departamento = "CUSCO",
  provincia = "CUSCO"
)

# Cargar distrito espec√≠fico
densidad_wanchaq <- get_densidad_poblacional(
  departamento = "CUSCO",
  provincia = "CUSCO",
  distrito = "WANCHAQ"
)
```

#### An√°lisis avanzado: Mapa con etiquetas de distritos
```{r}
prov_anta <- get_densidad_poblacional(
  departamento = "CUSCO",
  provincia = "ANTA", 
  distrito = c("CACHIMAYO", "PUCYURA", "ANTA"))

distritos_anta <- prov_anta |>
   group_by(ubigeo, nombdist) |>
   summarise(.groups = "drop")
 distritos_anta
# Calcular centroides para etiquetas
distritos_centroides <- st_point_on_surface(distritos_anta)

# Mapa completo
ggplot() +
  # 1. Celdas con el nivel de crecimiento
  geom_sf(
    data = prov_anta,
    aes(fill = nivel),
    color = NA
  ) +
  # 2. Contorno de distritos
  geom_sf(
    data = distritos_anta,
    fill  = NA,
    color = "grey20",
    linewidth = 0.4
  ) +
  # 3. Nombres de los distritos
  geom_sf_text(
    data = distritos_centroides,
    aes(label = nombdist),
    size = 3
  ) +
  scale_fill_brewer(
    palette = "RdYlGn",
    name = "Nivel de\ncrecimiento"
  ) +
  labs(
    title = "Crecimiento Poblacional",
    subtitle = "Provincia de Anta (2007-2017)",
    caption = "Fuente: INEI | Visor SDOT"
  ) +
  theme_minimal() +
  theme(
    legend.position = "right",
    panel.grid.major = element_line(linewidth = 0.2, colour = "grey90")
  )
```

#### Cargar m√∫ltiples departamentos
```{r}
# Cargar varios departamentos del sur
densidad_sur <- get_densidad_poblacional(
  departamento = c("CUSCO", "PUNO", "AREQUIPA")
)

# An√°lisis estad√≠stico por departamento
densidad_sur %>%
  st_drop_geometry() %>%
  count(nombdep, nivel) %>%
  ggplot(aes(x = nombdep, y = n, fill = nivel)) +
  geom_col(position = "fill") +
  scale_y_continuous(labels = scales::percent) +
  scale_fill_brewer(palette = "RdYlGn", name = "Nivel") +
  labs(
    title = "Distribuci√≥n de Niveles de Crecimiento Poblacional",
    subtitle = "Departamentos del Sur del Per√∫ (2007-2017)",
    x = "Departamento",
    y = "Porcentaje",
    caption = "Fuente: INEI"
  ) +
  coord_flip() +
  theme_minimal()
```

## üìä Fuentes de datos

Los datos provistos por este paquete provienen de:

- **SDOT-PCM** - Secretar√≠a de Demarcaci√≥n y Organizaci√≥n Territorial
  - https://geosdot.servicios.gob.pe/visor/

## ü§ù Contribuciones

Las contribuciones son bienvenidas. Por favor abre un issue o pull request:

üëâ https://github.com/PaulESantos/rsdot/issues

## üìÑ Licencia

Este paquete utiliza la licencia MIT. Consulta `LICENSE` para m√°s detalles.

## üë§ Autor

**Paul Efren Santos Andrade**

- ORCID: [0000-0002-6635-0375](https://orcid.org/0000-0002-6635-0375)
- Email: paulefrens@gmail.com

## üåê Sitio web del paquete

Documentaci√≥n ampliada y vi√±etas:

üëâ https://paulesantos.github.io/rsdot/

## üìö Citaci√≥n

Si utilizas este paquete en tus publicaciones, por favor c√≠talo como:
```{r}
citation("rsdot")
```
